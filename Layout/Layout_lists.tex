
%\setlist[itemize]{label=\textbullet}
\newcommand{\listsymbol}{\textbullet}

%%% Captions lists %%%

\newcommand{\captionlist}{\vspace*{3pt}\newline}
\newcommand{\captionitem}{\hspace*{0.3cm}}


%%% Lists with prices %%%

\newcommand{\startpricelist}{\raggedcolumns\begin{multicols}{2}\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]}
\def\endpricelist{\end{description}\end{multicols}}
\newcommand{\pricelistitem}[3]{\item \begin{samepage}\textbf{#1}\predotfill\hfill\nobreak\pts{#2}\newline{}#3\end{samepage}\par}
\newcommand{\nopricelistitem}[1]{\item \textbf{#1}\newline}

\newcommand{\startpricelistNSP}{\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]}
\def\endpricelistNSP{\end{description}}

\newtoggle{isdominant}
\newtoggle{guidingdominant}
\newtoggle{hasmaxnumber}
\newtoggle{hasrestriction}

\newcommand{\startsortedpricelist}{% designed to be used with \itementry
	\begin{samepage}\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]%
	\DTLifdbexists{sortedpricelist}{\DTLcleardb{sortedpricelist}}{\DTLnewdb{sortedpricelist}}% Create new/discard old list
}
\def\endsortedpricelist{%
	\DTLsort*{costsortlabel=descending,sortlabel}{sortedpricelist}% Sort list
	\DTLforeach*{sortedpricelist}{\ruletext=ruletext,\nameoftheitem=name,\cost=cost,\restriction=restriction,\maxnumber=maxnumber,\isdominant=dominant,\isenchantment=enchantment}{% Print back the ordered table
	\begin{samepage}\pricelistitem{\nameoftheitem}{\cost}{% Check if we need \itemrestriction
		\expandafter\ifblank\expandafter{\isdominant}{\togglefalse{isdominant}}{\toggletrue{isdominant}}%
		\expandafter\ifblank\expandafter{\maxnumber}{\togglefalse{hasmaxnumber}}{\toggletrue{hasmaxnumber}}%
		\expandafter\ifblank\expandafter{\restriction}{\togglefalse{hasrestriction}}{\toggletrue{hasrestriction}}%
		\ifboolexpr{togl {isdominant} or togl {hasmaxnumber} or togl {hasrestriction}}{%
			\itemrestriction{%
				\iftoggle{isdominant}{\dominant{}. }{}%
				\iftoggle{hasmaxnumber}{\zerotoXperarmy{\maxnumber}. }{}%
				\iftoggle{hasrestriction}{\restriction{}.}{}%			
			}%
		}{}%
		\expandafter\ifblank\expandafter{\isenchantment}{}{%
			\enchantmentrestriction{\isenchantment{}}%
		}%
		\ruletext{}%
		}%
	\end{samepage}%
	}%
	\end{description}\end{samepage}%
}

\newcommand{\sortedpricelistitem}[3]{% deprecated
	\DTLnewrow{sortedpricelist}%
	\DTLnewdbentry{sortedpricelist}{name}{#1}%
	\DTLnewdbentry{sortedpricelist}{cost}{#2}%
	\DTLnewdbentry{sortedpricelist}{ruletext}{#3}%
	\DTLnewdbentry{sortedpricelist}{enchantment}{}%
	\DTLnewdbentry{sortedpricelist}{maxnumber}{}%
	\DTLnewdbentry{sortedpricelist}{dominant}{}%
	\DTLnewdbentry{sortedpricelist}{restriction}{}%
	\pdfstringdef\textwithoutformatting{#1}%
	\pdfsubstitute\textwithoutformatting{'}{}%
	\pdfsubstitute\textwithoutformatting{ }{}%
	\dolanguagespecificsubstitute{}%
	\def\DTLentrycommand{\DTLnewdbentry{sortedpricelist}{sortlabel}}%
	\expandafter\DTLentrycommand\expandafter{\textwithoutformatting}%
	\pdfstringdef\costwithoutformatting{#2}%
	\pdfsubstitute\costwithoutformatting{ }{}%
	\pdfsubstitute\costwithoutformatting{\free}{0}%
	\pdfsubstitute\costwithoutformatting{\nolimit}{999999}%
	\substitute\costwithoutformatting{\string\376}{}%
	\substitute\costwithoutformatting{\string\377}{}%
	\substitute\costwithoutformatting{\string\000}{}%
	\def\DTLentrycommand{\DTLnewdbentry{sortedpricelist}{costsortlabel}}%
	\expandafter\DTLentrycommand\expandafter{\costwithoutformatting}%
}

\newcommand{\sortedpricelistitemhtgt}[3]{% deprecated
	\sortedpricelistitem{#1}{#2}{#3}%
	\def\temphypertag{}%
	\StrGobbleRight{\expandafter\@gobble\string#1}{1}[\temphypertag] % remove first the \ to the left and then the {} to the right - it counts as 1 character and then bug the hyperlink tag. It will remove the last character of the macro name if there is no {} in the end of the name key. So it should always be input as "name=\fancyunitname{},". "name=\fancyunitname," will make hyperlinks crash.
	\xdef\SPLitemhypertag{\temphypertag}% using the unit name macro to define an hypertag
	\def\DTLentrycommand{\DTLnewdbentry{sortedpricelist}{itemhypertag}}%
	\expandafter\DTLentrycommand\expandafter{\SPLitemhypertag}%
}

\newcommand{\startsortedpricelistNSP}{%
	\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]%
	\DTLifdbexists{sortedpricelist}{\DTLcleardb{sortedpricelist}}{\DTLnewdb{sortedpricelist}}% Create new/discard old list
}
\def\endsortedpricelistNSP{%
	\DTLsort*{costsortlabel=descending,sortlabel}{sortedpricelist}% Sort list
	\DTLforeach*{sortedpricelist}{\ruletext=ruletext,\nameoftheitem=name,\cost=cost,\restriction=restriction,\maxnumber=maxnumber,\isdominant=dominant,\isenchantment=enchantment}{% Print back the ordered table
	\pricelistitem{\nameoftheitem}{\cost}{% Check if we need \itemrestriction
	\expandafter\ifblank\expandafter{\isdominant}{\togglefalse{isdominant}}{\toggletrue{isdominant}}%
	\expandafter\ifblank\expandafter{\maxnumber}{\togglefalse{hasmaxnumber}}{\toggletrue{hasmaxnumber}}%
	\expandafter\ifblank\expandafter{\restriction}{\togglefalse{hasrestriction}}{\toggletrue{hasrestriction}}%
	\ifboolexpr{togl {isdominant} or togl {hasmaxnumber} or togl {hasrestriction}}{%
		\itemrestriction{%
			\iftoggle{isdominant}{\dominant{}. }{}%
			\iftoggle{hasmaxnumber}{\zerotoXperarmy{\maxnumber}. }{}%
			\iftoggle{hasrestriction}{\restriction{}.}{}%			
		}%
	}{}%
	\expandafter\ifblank\expandafter{\isenchantment}{}{%
		\enchantmentrestriction{\isenchantment{}}%
	}%
	\ruletext{}%
	}}%
	\end{description}%
}

\newcommand{\startsortedpricelisthtgt}{%
	\begin{samepage}\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]%
	\DTLifdbexists{sortedpricelist}{\DTLcleardb{sortedpricelist}}{\DTLnewdb{sortedpricelist}}% Create new/discard old list
}
\def\endsortedpricelisthtgt{%
	\DTLsort*{costsortlabel=descending,sortlabel}{sortedpricelist}% Sort list
	\DTLforeach*{sortedpricelist}{\ruletext=ruletext,\nameoftheitem=name,\cost=cost,\restriction=restriction,\maxnumber=maxnumber,\isdominant=dominant,\isenchantment=enchantment,\itemhypertag=itemhypertag,\guidingdominant=guidingdominant}{% Print back the ordered table
	\begin{samepage}\expandafter\hypertarget\expandafter{\itemhypertag}{\pricelistitem{\nameoftheitem}{\cost}{%
	\expandafter\ifblank\expandafter{\isdominant}{\togglefalse{isdominant}}{\toggletrue{isdominant}}%
	\expandafter\ifblank\expandafter{\guidingdominant}{\togglefalse{guidingdominant}}{\toggletrue{guidingdominant}}%
	\expandafter\ifblank\expandafter{\maxnumber}{\togglefalse{hasmaxnumber}}{\toggletrue{hasmaxnumber}}%
	\expandafter\ifblank\expandafter{\restriction}{\togglefalse{hasrestriction}}{\toggletrue{hasrestriction}}%
	\ifboolexpr{togl {guidingdominant} or togl {isdominant} or togl {hasmaxnumber} or togl {hasrestriction}}{%
		\itemrestriction{%
			\iftoggle{guidingdominant}{\guidingversion{\dominant{}}. }{}%
			\iftoggle{isdominant}{\dominant{}. }{}%
			\iftoggle{hasmaxnumber}{\zerotoXperarmy{\maxnumber}. }{}%
			\iftoggle{hasrestriction}{\restriction{}.}{}%			
		}%
	}{}%
	\expandafter\ifblank\expandafter{\isenchantment}{}{%
		\enchantmentrestriction{\isenchantment{}}%
	}%
	\ruletext{}%
	}}\end{samepage}%
	}%
	\end{description}\end{samepage}%
}

\newcommand{\startsortedpricelisthtgtNSP}{%
	\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]%
	\DTLifdbexists{sortedpricelist}{\DTLcleardb{sortedpricelist}}{\DTLnewdb{sortedpricelist}}% Create new/discard old list
}
\def\endsortedpricelisthtgtNSP{%
	\DTLsort*{costsortlabel=descending,sortlabel}{sortedpricelist}% Sort list
	\DTLforeach*{sortedpricelist}{\ruletext=ruletext,\nameoftheitem=name,\cost=cost,\restriction=restriction,\maxnumber=maxnumber,\isdominant=dominant,\isenchantment=enchantment,\itemhypertag=itemhypertag,\guidingdominant=guidingdominant}{% Print back the ordered table
	\expandafter\hypertarget\expandafter{\itemhypertag}{\pricelistitem{\nameoftheitem}{\cost}{%
	\expandafter\ifblank\expandafter{\isdominant}{\togglefalse{isdominant}}{\toggletrue{isdominant}}%
	\expandafter\ifblank\expandafter{\guidingdominant}{\togglefalse{guidingdominant}}{\toggletrue{guidingdominant}}%
	\expandafter\ifblank\expandafter{\maxnumber}{\togglefalse{hasmaxnumber}}{\toggletrue{hasmaxnumber}}%
	\expandafter\ifblank\expandafter{\restriction}{\togglefalse{hasrestriction}}{\toggletrue{hasrestriction}}%
	\ifboolexpr{togl {guidingdominant} or togl {isdominant} or togl {hasmaxnumber} or togl {hasrestriction}}{%
		\itemrestriction{%
			\iftoggle{guidingdominant}{\guidingversion{\dominant{}}. }{}%
			\iftoggle{isdominant}{\dominant{}. }{}%
			\iftoggle{hasmaxnumber}{\zerotoXperarmy{\maxnumber}. }{}%
			\iftoggle{hasrestriction}{\restriction{}.}{}%			
		}%
	}{}%
	\expandafter\ifblank\expandafter{\isenchantment}{}{%
		\enchantmentrestriction{\isenchantment{}}%
	}%
	\ruletext{}%
	}}%
	}%
	\end{description}%
}

\newcommand{\startitemlist}{\raggedcolumns\begin{multicols}{2}\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]}
\def\enditemlist{\end{description}\end{multicols}}
\newcommand{\listitem}[1]{\item[#1\spacebeforecolon{}:]}

\newcommand{\startitemlistonecol}{\begin{description}[leftmargin=0.3cm, labelindent=0cm, labelsep=0.1cm, itemsep=8pt]}
\def\enditemlistonecol{\end{description}}
\newcommand{\listitemonecol}[1]{\item \textbf{#1\spacebeforecolon{}:}\newline}

\newenvironment{smallitemize}{\begin{itemize}[itemsep=3pt,topsep=3pt]}{\end{itemize}}
\newenvironment{smallenumerate}{\begin{enumerate}[itemsep=3pt,topsep=3pt]}{\end{enumerate}}

%%% Army Model Rules sorting

\newcommand{\startAMRsortedlist}{%
	\DTLifdbexists{AMRlist}{\DTLcleardb{AMRlist}}{\DTLnewdb{AMRlist}}% Create new/discard old list
}

\newcommand{\closeAMRsortedlist}{%
	\DTLsort*{sortlabel}{AMRlist}% Sort list
	\DTLforeach*{AMRlist}{\name=name,\ruletext=ruletext}{%
		\subsubtitle{\name}
		\ruletext{}\par%
	}
	\DTLcleardb{AMRlist}%
}

\newcommand{\AMRsortedlistentry}[2]{%
	\DTLnewrow{AMRlist}%
	\pdfstringdef\textwithoutformatting{#1}%
	\pdfsubstitute\textwithoutformatting{'}{}%
	\pdfsubstitute\textwithoutformatting{ }{}%
	\dolanguagespecificsubstitute{}%
	\def\DTLentrycommand{\DTLnewdbentry{AMRlist}{sortlabel}}%
	\expandafter\DTLentrycommand\expandafter{\textwithoutformatting}%
	\DTLnewdbentry{AMRlist}{name}{#1}%
	\DTLnewdbentry{AMRlist}{ruletext}{#2}%
}
